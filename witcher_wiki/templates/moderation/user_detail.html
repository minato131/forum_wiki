{% extends 'base.html' %}

{% block title %}{{ target_user.username }} | –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏{% endblock %}

{% block content %}
<style>
    .info-card {
        background: #2c3e50;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .info-card.banned {
        border-left: 4px solid #e74c3c;
    }
    .info-card.warning {
        border-left: 4px solid #f39c12;
    }
    .info-card.normal {
        border-left: 4px solid #3498db;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    .stat-item {
        background: #34495e;
        padding: 1rem;
        border-radius: 6px;
        text-align: center;
    }
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #f1c40f;
    }
    .stat-label {
        color: #bdc3c7;
        font-size: 0.9rem;
    }
    .action-form {
        background: #34495e;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .history-item {
        background: #2c3e50;
        border-left: 4px solid #7f8c8d;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
    }
    .history-item.ban {
        border-left-color: #e74c3c;
    }
    .history-item.warning {
        border-left-color: #f39c12;
    }
</style>

<div class="container py-4">
    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <nav style="margin-bottom: 2rem; background: #2c3e50; padding: 1rem; border-radius: 8px;">
        <ol style="display: flex; list-style: none; margin: 0; padding: 0;">
            <li style="margin-right: 0.5rem;">
                <a href="{% url 'wiki:moderation_dashboard' %}" style="color: #ecf0f1; text-decoration: none; font-weight: 500;">–ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏</a>
            </li>
            <li style="margin-right: 0.5rem; color: #7f8c8d;">‚Ä∫</li>
            <li style="margin-right: 0.5rem;">
                <a href="{% url 'wiki:user_search' %}" style="color: #ecf0f1; text-decoration: none; font-weight: 500;">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
            </li>
            <li style="margin-right: 0.5rem; color: #7f8c8d;">‚Ä∫</li>
            <li style="color: #f1c40f; font-weight: 500;">{{ target_user.username }}</li>
        </ol>
    </nav>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div style="background: linear-gradient(135deg, #34495e, #2c3e50); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin: 0; color: #ecf0f1; display: flex; align-items: center; gap: 1rem;">
                    <span style="background: #3498db; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                        üë§
                    </span>
                    {{ target_user.username }}
                    {% if user_status.is_banned %}
                    <span style="background: #e74c3c; color: white; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.9rem;">
                        ‚õî –ó–∞–±–∞–Ω–µ–Ω
                    </span>
                    {% endif %}
                </h1>
                <p style="color: #bdc3c7; margin-top: 0.5rem; margin-bottom: 0;">
                    ID: {{ target_user.id }} ‚Ä¢ Email: {{ target_user.email }} ‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {{ target_user.date_joined|date:"d.m.Y H:i" }}
                </p>
            </div>
            <div>
                <a href="/admin/auth/user/{{ target_user.id }}/change/" class="btn btn-outline-light" target="_blank">
                    ‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ
                </a>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="info-card {% if user_status.is_banned %}banned{% elif user_status.total_warnings > 0 %}warning{% else %}normal{% endif %}">
        <h3 style="color: #ecf0f1; margin-bottom: 1rem;">–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h3>
        
        {% if user_status.is_banned %}
        <div style="background: rgba(231, 76, 60, 0.2); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <div style="font-size: 1.5rem;">‚õî</div>
                <div>
                    <h4 style="margin: 0; color: #e74c3c;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω</h4>
                    <p style="margin: 0; color: #bdc3c7;">
                        –ü—Ä–∏—á–∏–Ω–∞: {{ user_status.ban_details.get_reason_display }}
                        ‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ user_status.ban_details.get_duration_display }}
                    </p>
                </div>
            </div>
            <p style="color: #bdc3c7; margin-bottom: 0.5rem;">
                <strong>–û—Å—Ç–∞–ª–æ—Å—å:</strong> {{ user_status.ban_details.time_remaining }}
                <br>
                <strong>–ò—Å—Ç–µ–∫–∞–µ—Ç:</strong> {{ user_status.ban_details.end_time|date:"d.m.Y H:i" }}
            </p>
            {% if user_status.ban_details.notes %}
            <p style="color: #bdc3c7; margin-bottom: 0;">
                <strong>–ó–∞–º–µ—Ç–∫–∏:</strong> {{ user_status.ban_details.notes }}
            </p>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ user_status.active_warnings }}</div>
                <div class="stat-label">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ user_status.censorship_warnings }}</div>
                <div class="stat-label">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π —Ü–µ–Ω–∑—É—Ä—ã</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ target_user.article_set.count }}</div>
                <div class="stat-label">–°—Ç–∞—Ç–µ–π</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ target_user.comment_set.count }}</div>
                <div class="stat-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
            </div>
        </div>
        
        <div style="color: #bdc3c7; font-size: 0.9rem;">
            <strong>–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:</strong>
            {% if user_status.can_post %} –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–µ–π ‚Ä¢{% endif %}
            {% if user_status.can_comment %} –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ä¢{% endif %}
            {% if user_status.can_message %} –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π{% endif %}
        </div>
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <div class="row">
        <div class="col-md-6">
            <!-- –í—ã–¥–∞—Ç—å –±–∞–Ω -->
            <div class="action-form">
                <h4 style="color: #ecf0f1; margin-bottom: 1rem;">‚õî –í—ã–¥–∞—Ç—å –±–∞–Ω</h4>
                {% if user_status.is_banned %}
                <div style="background: rgba(231, 76, 60, 0.2); padding: 1rem; border-radius: 6px;">
                    <p style="color: #e74c3c; margin: 0;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞–±–∞–Ω–µ–Ω</p>
                </div>
                {% else %}
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="ban">
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–ü—Ä–∏—á–∏–Ω–∞:</label>
                        {{ ban_form.reason }}
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</label>
                        {{ ban_form.duration }}
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        {{ ban_form.notes }}
                    </div>
                    
                    <button type="submit" class="btn btn-danger" style="width: 100%; background: #e74c3c; border: none;">
                        ‚õî –í—ã–¥–∞—Ç—å –±–∞–Ω
                    </button>
                </form>
                {% endif %}
            </div>
            
            <!-- –°–Ω—è—Ç—å –±–∞–Ω -->
            {% if user_status.is_banned %}
            <div class="action-form">
                <h4 style="color: #ecf0f1; margin-bottom: 1rem;">‚úÖ –°–Ω—è—Ç—å –±–∞–Ω</h4>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="unban">
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è:</label>
                        <input type="text" name="unban_reason" class="form-control" 
                               placeholder="–ü—Ä–∏—á–∏–Ω–∞ —Å–Ω—è—Ç–∏—è –±–∞–Ω–∞..." style="background: #2c3e50; border-color: #7f8c8d; color: white;">
                    </div>
                    
                    <button type="submit" class="btn btn-success" style="width: 100%; background: #27ae60; border: none;">
                        ‚úÖ –°–Ω—è—Ç—å –±–∞–Ω
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-6">
            <!-- –í—ã–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
            <div class="action-form">
                <h4 style="color: #ecf0f1; margin-bottom: 1rem;">‚ö†Ô∏è –í—ã–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</h4>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="warning">
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏:</label>
                        {{ warning_form.severity }}
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–ü—Ä–∏—á–∏–Ω–∞:</label>
                        {{ warning_form.reason }}
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="color: #bdc3c7; display: block; margin-bottom: 0.5rem;">–°–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ):</label>
                        {{ warning_form.related_content }}
                    </div>
                    
                    <button type="submit" class="btn btn-warning" style="width: 100%; background: #f39c12; border: none;">
                        ‚ö†Ô∏è –í—ã–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    </button>
                </form>
            </div>
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="action-form">
                <h4 style="color: #ecf0f1; margin-bottom: 1rem;">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                <div style="display: grid; gap: 0.5rem;">
                    <a href="{% url 'wiki:my_censorship_warnings' %}" class="btn btn-outline-info" 
                       style="border-color: #3498db; color: #3498db;">
                        üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </a>
                    <a href="{% url 'accounts:profile' %}" class="btn btn-outline-info" 
                       style="border-color: #9b59b6; color: #9b59b6;">
                        üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –±–∞–Ω–æ–≤ -->
    {% if ban_history %}
    <div class="info-card">
        <h3 style="color: #ecf0f1; margin-bottom: 1rem;">üìú –ò—Å—Ç–æ—Ä–∏—è –±–∞–Ω–æ–≤</h3>
        {% for ban in ban_history %}
        <div class="history-item ban">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <div style="color: #ecf0f1; font-weight: 500;">
                    {{ ban.get_reason_display }} ‚Ä¢ {{ ban.get_duration_display }}
                </div>
                <div style="color: #bdc3c7; font-size: 0.9rem;">
                    {{ ban.created_at|date:"d.m.Y H:i" }}
                </div>
            </div>
            <div style="color: #bdc3c7; font-size: 0.9rem;">
                <strong>–ó–∞–±–∞–Ω–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º:</strong> {{ ban.banned_by.username|default:"–°–∏—Å—Ç–µ–º–∞" }}
                {% if ban.notes %}
                <br><strong>–ó–∞–º–µ—Ç–∫–∏:</strong> {{ ban.notes }}
                {% endif %}
                <br><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                <span style="color: {% if ban.is_active %}#e74c3c{% else %}#27ae60{% endif %};">
                    {% if ban.is_active %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–ó–∞–≤–µ—Ä—à–µ–Ω{% endif %}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π -->
    {% if warning_history %}
    <div class="info-card">
        <h3 style="color: #ecf0f1; margin-bottom: 1rem;">üìù –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</h3>
        {% for warning in warning_history %}
        <div class="history-item warning">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <div>
                    <span style="color: #ecf0f1; font-weight: 500;">
                        –£—Ä–æ–≤–µ–Ω—å {{ warning.severity }}: {{ warning.get_severity_display }}
                    </span>
                    {% if warning.is_active %}
                    <span style="background: #f39c12; color: white; padding: 0.15rem 0.5rem; border-radius: 10px; font-size: 0.8rem;">
                        –ê–∫—Ç–∏–≤–Ω–æ
                    </span>
                    {% endif %}
                </div>
                <div style="color: #bdc3c7; font-size: 0.9rem;">
                    {{ warning.created_at|date:"d.m.Y H:i" }}
                </div>
            </div>
            <div style="color: #bdc3c7; font-size: 0.9rem; margin-bottom: 0.5rem;">
                {{ warning.reason }}
            </div>
            {% if warning.related_content %}
            <div style="color: #95a5a6; font-size: 0.85rem;">
                <strong>–°–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:</strong> {{ warning.related_content }}
            </div>
            {% endif %}
            <div style="color: #95a5a6; font-size: 0.85rem; margin-top: 0.5rem;">
                <strong>–í—ã–¥–∞–Ω–æ:</strong> {{ warning.issued_by.username|default:"–°–∏—Å—Ç–µ–º–∞" }}
                {% if warning.expires_at %}
                ‚Ä¢ <strong>–ò—Å—Ç–µ–∫–∞–µ—Ç:</strong> {{ warning.expires_at|date:"d.m.Y" }}
                {% endif %}
            </div>
            
            {% if warning.is_active %}
            <div style="margin-top: 0.5rem;">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="remove_warning">
                    <input type="hidden" name="warning_id" value="{{ warning.id }}">
                    <button type="submit" class="btn btn-sm btn-outline-danger" 
                            onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–Ω—è—Ç—å —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ?');">
                        ‚ùå –°–Ω—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
    <div style="text-align: center; margin-top: 2rem;">
        <a href="{% url 'wiki:user_search' %}" class="btn btn-secondary" style="background: #7f8c8d; border: none;">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É
        </a>
    </div>
</div>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block title %}–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram{% endblock %}

{% block content %}
<div class="quick-login-container">
    <div class="quick-login-card">
        <div class="login-header">
            <div class="login-icon">‚öîÔ∏è</div>
            <h1>–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥</h1>
            <p>–ß–µ—Ä–µ–∑ Telegram –±–æ—Ç</p>
        </div>

        <div class="login-content">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            {% if not user.is_authenticated %}
                <div class="login-instructions">
                    <h3>üìã –ö–∞–∫ –≤–æ–π—Ç–∏:</h3>
                    <ol>
                        <li>–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram</li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/login</code></li>
                        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç" –≤ –±–æ—Ç–µ</li>
                        <li>–í—ã –±—É–¥–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã</li>
                    </ol>

                    <div class="note">
                        <strong>üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 10 –º–∏–Ω—É—Ç
                    </div>
                </div>

                <div class="bot-actions">
                    <a href="https://t.me/{{ telegram_bot_username }}?start=login" target="_blank" class="btn btn-telegram">
                        üì± –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞
                    </a>
                    <a href="{% url 'wiki:telegram_auth' %}" class="btn btn-outline">
                        üîê –î—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã
                    </a>
                </div>

                <div class="qr-code-section">
                    <h4>üì≤ –ò–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥:</h4>
                    <div class="qr-container">
                        <div id="qrcode"></div>
                    </div>
                    <p class="qr-note">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞ QR-–∫–æ–¥ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</p>
                </div>
            {% else %}
                <div class="success-message">
                    <div style="text-align: center; padding: 30px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">‚úÖ</div>
                        <h3 style="color: #22c55e;">–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!</h3>
                        <p style="color: #e8e8e8;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</p>
                        <div class="success-actions">
                            <a href="{% url 'wiki:home' %}" class="btn btn-primary">
                                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </a>
                            <a href="{% url 'wiki:profile' %}" class="btn btn-outline">
                                üë§ –ü—Ä–æ—Ñ–∏–ª—å
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.quick-login-container {
    max-width: 500px;
    margin: 30px auto;
    padding: 20px;
}

.quick-login-card {
    background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
    padding: 40px 30px;
    border-radius: 20px;
    border: 2px solid #D4AF37;
}

.login-header {
    text-align: center;
    margin-bottom: 30px;
}

.login-icon {
    font-size: 4em;
    margin-bottom: 15px;
}

.login-header h1 {
    color: #D4AF37;
    margin-bottom: 10px;
    font-family: 'Cinzel', serif;
}

.login-header p {
    color: #e8e8e8;
    opacity: 0.8;
}

.alert {
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid;
}

.alert-success {
    background: rgba(34, 197, 94, 0.1);
    border-color: #22c55e;
    color: #22c55e;
}

.alert-error {
    background: rgba(239, 68, 68, 0.1);
    border-color: #ef4444;
    color: #ef4444;
}

.login-instructions {
    background: rgba(212, 175, 55, 0.1);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    border-left: 4px solid #D4AF37;
}

.login-instructions h3 {
    color: #D4AF37;
    margin-bottom: 15px;
}

.login-instructions ol {
    color: #e8e8e8;
    padding-left: 20px;
    margin-bottom: 15px;
}

.login-instructions li {
    margin-bottom: 10px;
}

.login-instructions code {
    background: rgba(212, 175, 55, 0.2);
    color: #D4AF37;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: monospace;
}

.note {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    padding: 12px;
    border-radius: 8px;
    color: #3b82f6;
    font-size: 0.9em;
}

.bot-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-bottom: 30px;
}

.qr-code-section {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

.qr-code-section h4 {
    color: #D4AF37;
    margin-bottom: 15px;
}

.qr-container {
    display: inline-block;
    padding: 15px;
    background: white;
    border-radius: 8px;
    margin-bottom: 10px;
}

.qr-note {
    color: #888;
    font-size: 0.9em;
}

.success-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
}

.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 20px;
    background: #D4AF37;
    color: #1a1a1a;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    transition: all 0.3s;
    border: 2px solid #D4AF37;
    cursor: pointer;
    font-family: inherit;
}

.btn-telegram {
    background: #0088cc;
    color: white;
    border-color: #0088cc;
}

.btn-telegram:hover {
    background: #0077b3;
    border-color: #0077b3;
}

.btn-outline {
    background: transparent;
    color: #D4AF37;
}

.btn-outline:hover {
    background: #D4AF37;
    color: #1a1a1a;
}

.btn-primary {
    background: #D4AF37;
    color: #1a1a1a;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
}

@media (max-width: 768px) {
    .quick-login-container {
        margin: 15px auto;
        padding: 10px;
    }

    .quick-login-card {
        padding: 25px 20px;
    }

    .bot-actions, .success-actions {
        flex-direction: column;
    }

    .qr-container {
        padding: 10px;
    }
}
</style>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è QR-–∫–æ–¥–∞ -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –¥–ª—è –±–æ—Ç–∞
    const botUrl = 'https://t.me/{{ telegram_bot_username }}?start=login';
    const qrContainer = document.getElementById('qrcode');

    if (qrContainer) {
        QRCode.toCanvas(qrContainer, botUrl, {
            width: 200,
            height: 200,
            colorDark: '#1a1a1a',
            colorLight: '#ffffff',
            margin: 1
        }, function(error) {
            if (error) {
                console.error('QR code error:', error);
                qrContainer.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞</p>';
            }
        });
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            alert.style.opacity = '0';
            alert.style.transition = 'opacity 0.5s';
            setTimeout(function() {
                alert.remove();
            }, 500);
        });
    }, 5000);
});
</script>
{% endblock %}
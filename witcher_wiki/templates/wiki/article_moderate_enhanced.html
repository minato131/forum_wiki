{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ–¥–µ—Ä–∞—Ü–∏—è: {{ article.title }} | –§–æ—Ä—É–º –ø–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞{% endblock %}

{% block content %}
<div class="moderation-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #2d2d2d; border-radius: 10px; border: 2px solid #D4AF37;">
        <h1 style="color: #D4AF37; margin-bottom: 10px;">üéØ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ú–û–î–ï–†–ê–¶–ò–Ø</h1>
        <h2 style="color: white;">{{ article.title }}</h2>
        <p style="color: #888;">–ê–≤—Ç–æ—Ä: {{ article.author.username }} | –°—Ç–∞—Ç—É—Å: {{ article.get_status_display }}</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 400px; gap: 30px;">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div style="background: #2d2d2d; padding: 25px; border-radius: 10px; border: 1px solid #444;">
            <h3 style="color: #D4AF37; margin-bottom: 15px;">üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h3>

            <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                <button id="toggleHighlight" style="background: #D4AF37; color: #1a1a1a; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    üñäÔ∏è –í–∫–ª—é—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                </button>
                <span id="highlightStatus" style="color: #888;">–í—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ</span>
            </div>

            <div id="contentArea" style="background: #1a1a1a; border: 2px solid #444; border-radius: 8px; padding: 20px; min-height: 500px; line-height: 1.6;">
                {{ article.content|safe }}
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –¥–µ–π—Å—Ç–≤–∏—è -->
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <div style="background: #2d2d2d; padding: 20px; border-radius: 10px; border: 1px solid #444;">
                <h3 style="color: #D4AF37; margin-bottom: 15px;">üí¨ –ù–æ–≤–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ</h3>

                <form id="commentForm">
                    {% csrf_token %}
                    <div style="margin-bottom: 15px;">
                        <label style="color: #D4AF37; display: block; margin-bottom: 5px;">–í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
                        <div id="selectedTextPreview" style="background: rgba(212, 175, 55, 0.1); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 5px; padding: 10px; min-height: 40px; color: #888;">
                            –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ —Å—Ç–∞—Ç—å–µ...
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="color: #D4AF37; display: block; margin-bottom: 5px;">–í–∞–∂–Ω–æ—Å—Ç—å:</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div class="severity-option" data-severity="low" style="padding: 10px; border: 1px solid #444; border-radius: 5px; text-align: center; cursor: pointer; color: #6b7280;">
                                üí° –ù–∏–∑–∫–∞—è
                            </div>
                            <div class="severity-option selected" data-severity="medium" style="padding: 10px; border: 1px solid #D4AF37; border-radius: 5px; text-align: center; cursor: pointer; color: #f59e0b; background: rgba(212, 175, 55, 0.1);">
                                ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è
                            </div>
                            <div class="severity-option" data-severity="high" style="padding: 10px; border: 1px solid #444; border-radius: 5px; text-align: center; cursor: pointer; color: #ef4444;">
                                üö® –í—ã—Å–æ–∫–∞—è
                            </div>
                            <div class="severity-option" data-severity="critical" style="padding: 10px; border: 1px solid #444; border-radius: 5px; text-align: center; cursor: pointer; color: #dc2626;">
                                üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
                            </div>
                        </div>
                        <input type="hidden" id="severity" name="severity" value="medium">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="color: #D4AF37; display: block; margin-bottom: 5px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                        <textarea name="comment" style="width: 100%; background: #1a1a1a; border: 1px solid #444; color: white; padding: 10px; border-radius: 5px; min-height: 80px;" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
                    </div>

                    <button type="submit" style="width: 100%; background: #D4AF37; color: #1a1a1a; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏–µ
                    </button>
                </form>
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
            <div style="background: #2d2d2d; padding: 20px; border-radius: 10px; border: 1px solid #444;">
                <h3 style="color: #D4AF37; margin-bottom: 15px;">‚öñÔ∏è –†–µ—à–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—å–µ</h3>

                <form method="post">
                    {% csrf_token %}
                    <div style="margin-bottom: 15px;">
                        <label style="color: #D4AF37; display: block; margin-bottom: 5px;">–û–±—â–∏–µ –∑–∞–º–µ—Ç–∫–∏:</label>
                        <textarea name="moderation_notes" style="width: 100%; background: #1a1a1a; border: 1px solid #444; color: white; padding: 10px; border-radius: 5px; min-height: 60px;">{{ article.moderation_notes }}</textarea>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button type="submit" name="action" value="approve" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer;">
                            ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å —Å—Ç–∞—Ç—å—é
                        </button>
                        <button type="submit" name="action" value="needs_correction" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer;">
                            ‚úèÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É
                        </button>
                        <button type="submit" name="action" value="reject" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer;">
                            ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å —Å—Ç–∞—Ç—å—é
                        </button>
                    </div>
                </form>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div style="background: #2d2d2d; padding: 20px; border-radius: 10px; border: 1px solid #444;">
                <h3 style="color: #D4AF37; margin-bottom: 15px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div style="text-align: center; padding: 15px; background: #1a1a1a; border-radius: 5px;">
                        <div style="color: #D4AF37; font-size: 24px; font-weight: bold;">{{ moderation_comments.count }}</div>
                        <div style="color: #888; font-size: 14px;">–í—Å–µ–≥–æ –∑–∞–º–µ—á–∞–Ω–∏–π</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #1a1a1a; border-radius: 5px;">
                        <div style="color: #D4AF37; font-size: 24px; font-weight: bold;">{{ open_comments_count }}</div>
                        <div style="color: #888; font-size: 14px;">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è -->
<div id="highlightTools" style="position: fixed; background: #2d2d2d; border: 1px solid #D4AF37; border-radius: 8px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 1000; display: none;">
    <div style="color: #D4AF37; font-weight: bold; text-align: center; margin-bottom: 10px;">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏–µ</div>
    <div id="toolsTextPreview" style="background: rgba(212, 175, 55, 0.1); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; padding: 8px; margin-bottom: 10px; font-size: 14px;"></div>
    <button id="addCommentBtn" style="width: 100%; background: #D4AF37; color: #1a1a1a; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold;">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏–µ
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('–£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');

    const contentArea = document.getElementById('contentArea');
    const toggleHighlightBtn = document.getElementById('toggleHighlight');
    const highlightStatus = document.getElementById('highlightStatus');
    const highlightTools = document.getElementById('highlightTools');

    let isHighlightMode = false;

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
    toggleHighlightBtn.addEventListener('click', function() {
        isHighlightMode = !isHighlightMode;

        if (isHighlightMode) {
            contentArea.style.borderColor = '#D4AF37';
            highlightStatus.textContent = '–í—ã–¥–µ–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ';
            highlightStatus.style.color = '#D4AF37';
            toggleHighlightBtn.innerHTML = 'üñäÔ∏è –í—ã–∫–ª—é—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ';
            toggleHighlightBtn.style.background = '#22c55e';
        } else {
            contentArea.style.borderColor = '#444';
            highlightStatus.textContent = '–í—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ';
            highlightStatus.style.color = '#888';
            toggleHighlightBtn.innerHTML = 'üñäÔ∏è –í–∫–ª—é—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ';
            toggleHighlightBtn.style.background = '#D4AF37';
            highlightTools.style.display = 'none';
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    contentArea.addEventListener('mouseup', function(e) {
        if (!isHighlightMode) return;

        const selection = window.getSelection();
        const selectedText = selection.toString().trim();

        if (selectedText.length > 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            highlightTools.style.left = (e.pageX + 10) + 'px';
            highlightTools.style.top = (e.pageY + 10) + 'px';
            highlightTools.style.display = 'block';

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–µ–≤—å—é
            document.getElementById('toolsTextPreview').textContent = selectedText;
            document.getElementById('selectedTextPreview').textContent = selectedText;
        }
    });

    // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    document.getElementById('addCommentBtn').addEventListener('click', function() {
        highlightTools.style.display = 'none';
        document.querySelector('textarea[name="comment"]').focus();
    });

    // –í—ã–±–æ—Ä –≤–∞–∂–Ω–æ—Å—Ç–∏
    document.querySelectorAll('.severity-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.severity-option').forEach(opt => {
                opt.style.borderColor = '#444';
                opt.style.background = 'transparent';
            });
            this.style.borderColor = '#D4AF37';
            this.style.background = 'rgba(212, 175, 55, 0.1)';
            document.getElementById('severity').value = this.dataset.severity;
        });
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
    document.addEventListener('click', function(e) {
        if (!highlightTools.contains(e.target) && e.target !== contentArea) {
            highlightTools.style.display = 'none';
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            isHighlightMode = false;
            contentArea.style.borderColor = '#444';
            highlightStatus.textContent = '–í—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ';
            highlightStatus.style.color = '#888';
            toggleHighlightBtn.innerHTML = 'üñäÔ∏è –í–∫–ª—é—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ';
            toggleHighlightBtn.style.background = '#D4AF37';
            highlightTools.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
{% extends "base.html" %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - {{ target_user.username }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 20px auto; padding: 20px;">
    <h1 style="color: #D4AF37; margin-bottom: 20px; border-bottom: 2px solid #D4AF37; padding-bottom: 10px;">
        üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    </h1>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin-bottom: 30px;">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div style="background: #2d2d2d; border: 1px solid #D4AF37; border-radius: 10px; padding: 25px;">
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 4em; color: #D4AF37; margin-bottom: 15px;">üë§</div>
                <h2 style="color: #FFD700; margin-bottom: 5px;">{{ target_user.username }}</h2>
                <div style="color: #95a5a6;">{{ target_user.email }}</div>
            </div>

            <div style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: #e8e8e8;">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                    <span style="color: #95a5a6;">{{ target_user.date_joined|date:"d.m.Y" }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: #e8e8e8;">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                    <span style="color: #95a5a6;">{{ target_user.last_login|date:"d.m.Y H:i"|default:"–ù–∏–∫–æ–≥–¥–∞" }}</span>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å—Ç–∞—Ç—É—Å –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div style="background: #2d2d2d; border: 1px solid #D4AF37; border-radius: 10px; padding: 25px;">
            <h3 style="color: #FFD700; margin-bottom: 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 10px;">
                –°—Ç–∞—Ç—É—Å –∏ –¥–µ–π—Å—Ç–≤–∏—è
            </h3>

            <!-- –°—Ç–∞—Ç—É—Å –±–ª–æ–∫ -->
            <div style="margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="color: #e8e8e8; font-weight: bold;">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞:</span>
                    {% if user_status.is_banned %}
                        <span style="background: #dc3545; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                            üö´ –ó–∞–±–∞–Ω–µ–Ω
                        </span>
                    {% else %}
                        <span style="background: #28a745; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                            ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
                        </span>
                    {% endif %}
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                        <div style="font-size: 1.5em; color: #ffc107; margin-bottom: 5px;">‚ö†Ô∏è</div>
                        <div style="color: #e8e8e8; font-size: 1.8em; font-weight: bold;">{{ user_status.total_warnings }}</div>
                        <div style="color: #95a5a6; font-size: 0.9em;">–í—Å–µ–≥–æ –ø—Ä–µ–¥.</div>
                    </div>

                    <div style="text-align: center; background: rgba(231, 76, 60, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #e74c3c;">
                        <div style="font-size: 1.5em; color: #e74c3c; margin-bottom: 5px;">üîû</div>
                        <div style="color: #e8e8e8; font-size: 1.8em; font-weight: bold;">{{ user_status.censorship_warnings }}</div>
                        <div style="color: #95a5a6; font-size: 0.9em;">–¶–µ–Ω–∑—É—Ä–∞</div>
                    </div>

                    <div style="text-align: center; background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #3498db;">
                        <div style="font-size: 1.5em; color: #3498db; margin-bottom: 5px;">üìä</div>
                        <div style="color: #e8e8e8; font-size: 1.8em; font-weight: bold;">{{ user_status.active_warnings }}</div>
                        <div style="color: #95a5a6; font-size: 0.9em;">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ</div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="color: {% if user_status.can_post %}#28a745{% else %}#dc3545{% endif %};">
                            {% if user_status.can_post %}‚úÖ{% else %}‚ùå{% endif %}
                        </div>
                        <span style="color: #e8e8e8;">–ú–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å–∏</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="color: {% if user_status.can_comment %}#28a745{% else %}#dc3545{% endif %};">
                            {% if user_status.can_comment %}‚úÖ{% else %}‚ùå{% endif %}
                        </div>
                        <span style="color: #e8e8e8;">–ú–æ–∂–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="color: {% if user_status.can_message %}#28a745{% else %}#dc3545{% endif %};">
                            {% if user_status.can_message %}‚úÖ{% else %}‚ùå{% endif %}
                        </div>
                        <span style="color: #e8e8e8;">–ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</span>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <a href="{% url 'wiki:warn_user' target_user.id %}"
                   style="background: #ffc107; color: #1a1a1a; padding: 12px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
                    ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å
                </a>

                {% if user_status.is_banned %}
                    <form method="post" style="margin: 0;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="unban">
                        <input type="hidden" name="unban_reason" value="–î–æ—Å—Ä–æ—á–Ω–æ–µ —Å–Ω—è—Ç–∏–µ">
                        <button type="submit"
                                style="background: #28a745; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                            ‚úÖ –†–∞–∑–±–∞–Ω–∏—Ç—å
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'wiki:ban_user' target_user.id %}"
                       style="background: #dc3545; color: white; padding: 12px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
                        üö´ –ó–∞–±–∞–Ω–∏—Ç—å
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div style="background: #2d2d2d; border: 1px solid #D4AF37; border-radius: 10px; overflow: hidden; margin-bottom: 30px;">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ -->
        <div style="display: flex; background: #1a1a1a; border-bottom: 1px solid #D4AF37;">
            <button onclick="showTab('bans')"
                    style="flex: 1; background: #2d2d2d; color: #D4AF37; border: none; padding: 15px; font-weight: bold; cursor: pointer; border-right: 1px solid #D4AF37;">
                üö´ –ò—Å—Ç–æ—Ä–∏—è –±–∞–Ω–æ–≤ ({{ ban_history.count }})
            </button>
            <button onclick="showTab('warnings')"
                    style="flex: 1; background: #2d2d2d; color: #D4AF37; border: none; padding: 15px; font-weight: bold; cursor: pointer;">
                ‚ö†Ô∏è –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π ({{ warning_history.count }})
            </button>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
        <div id="bansTab" style="padding: 25px; display: block;">
            {% if ban_history %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #1a1a1a;">
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–°—Ç–∞—Ç—É—Å</th>
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–ü—Ä–∏—á–∏–Ω–∞</th>
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–ó–∞–±–∞–Ω–∏–ª</th>
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                            <th style="padding: 12px; text-align: left; color: #dc3545; border-bottom: 2px solid #dc3545;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ban in ban_history %}
                        <tr style="border-bottom: 1px solid rgba(220, 53, 69, 0.2);">
                            <td style="padding: 12px;">
                                {% if ban.is_active and not ban.is_expired %}
                                    <span style="background: #dc3545; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px;">
                                        –ê–∫—Ç–∏–≤–µ–Ω
                                    </span>
                                {% else %}
                                    <span style="background: #6c757d; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px;">
                                        –ù–µ–∞–∫—Ç–∏–≤–µ–Ω
                                    </span>
                                {% endif %}
                            </td>
                            <td style="padding: 12px; color: #e74c3c;">{{ ban.reason }}</td>
                            <td style="padding: 12px;">
                                <span style="color: #3498db;">{{ ban.banned_by.username }}</span>
                            </td>
                            <td style="padding: 12px; color: #95a5a6;">{{ ban.created_at|date:"d.m.Y H:i" }}</td>
                            <td style="padding: 12px; color: #95a5a6;">
                                {% if ban.expires_at %}
                                    {{ ban.expires_at|date:"d.m.Y H:i" }}
                                {% else %}
                                    –ë–µ—Å—Å—Ä–æ—á–Ω–æ
                                {% endif %}
                            </td>
                            <td style="padding: 12px;">
                                {{ ban.get_duration_display }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 4em; color: #28a745; margin-bottom: 20px;">‚úÖ</div>
                <h3 style="color: #e8e8e8; margin-bottom: 10px;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –±–∞–Ω–æ–≤</h3>
                <p style="color: #95a5a6;">–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.</p>
            </div>
            {% endif %}
        </div>

        <div id="warningsTab" style="padding: 25px; display: none;">
            {% if warning_history %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #1a1a1a;">
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–°—Ç–∞—Ç—É—Å</th>
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–£—Ä–æ–≤–µ–Ω—å</th>
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–ü—Ä–∏—á–∏–Ω–∞</th>
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–ö–µ–º –≤—ã–¥–∞–Ω–æ</th>
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–î–∞—Ç–∞</th>
                            <th style="padding: 12px; text-align: left; color: #ffc107; border-bottom: 2px solid #ffc107;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for warning in warning_history %}
                        <tr style="border-bottom: 1px solid rgba(255, 193, 7, 0.2);">
                            <td style="padding: 12px;">
                                {% if warning.is_active %}
                                    <span style="background: #ffc107; color: #1a1a1a; padding: 3px 8px; border-radius: 3px; font-size: 12px;">
                                        –ê–∫—Ç–∏–≤–Ω–æ
                                    </span>
                                {% else %}
                                    <span style="background: #6c757d; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px;">
                                        –°–Ω—è—Ç–æ
                                    </span>
                                {% endif %}
                            </td>
                            <td style="padding: 12px;">
                                <span style="color: #ffc107; font-weight: bold;">
                                    {{ warning.get_severity_display }}
                                </span>
                            </td>
                            <td style="padding: 12px; color: #e8e8e8;">{{ warning.reason }}</td>
                            <td style="padding: 12px;">
                                <span style="color: #3498db;">{{ warning.issued_by.username }}</span>
                            </td>
                            <td style="padding: 12px; color: #95a5a6;">{{ warning.created_at|date:"d.m.Y H:i" }}</td>
                            <td style="padding: 12px;">
                                {% if warning.is_active %}
                                <form method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="remove_warning">
                                    <input type="hidden" name="warning_id" value="{{ warning.id }}">
                                    <button type="submit"
                                            style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.9em;">
                                        –°–Ω—è—Ç—å
                                    </button>
                                </form>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 4em; color: #28a745; margin-bottom: 20px;">‚úÖ</div>
                <h3 style="color: #e8e8e8; margin-bottom: 10px;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</h3>
                <p style="color: #95a5a6;">–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    document.getElementById('bansTab').style.display = 'none';
    document.getElementById('warningsTab').style.display = 'none';

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    const buttons = document.querySelectorAll('[onclick^="showTab"]');
    buttons.forEach(btn => {
        btn.style.background = '#2d2d2d';
        btn.style.color = '#D4AF37';
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
    document.getElementById(tabName + 'Tab').style.display = 'block';
    event.target.style.background = '#D4AF37';
    event.target.style.color = '#1a1a1a';
}
</script>
{% endblock %}
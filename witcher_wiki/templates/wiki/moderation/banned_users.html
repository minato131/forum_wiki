{% extends "base.html" %}
{% load static %}

{% block title %}–ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 20px auto; padding: 20px;">
    <h1 style="color: #D4AF37; margin-bottom: 20px; border-bottom: 2px solid #D4AF37; padding-bottom: 10px;">
        üö´ –ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    </h1>

    <div style="background: #2d2d2d; border: 1px solid #D4AF37; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: #FFD700; margin: 0;">
                –í—Å–µ–≥–æ –∑–∞–±–∞–Ω–µ–Ω–æ: <span style="color: #e74c3c;">{{ total_banned }}</span>
            </h3>
        </div>

        {% if page_obj %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #1a1a1a;">
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–ü—Ä–∏—á–∏–Ω–∞</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–ó–∞–±–∞–Ω–∏–ª</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–î–∞—Ç–∞ –±–∞–Ω–∞</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–ò—Å—Ç–µ–∫–∞–µ—Ç</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–û—Å—Ç–∞–ª–æ—Å—å</th>
                        <th style="padding: 12px; text-align: left; color: #D4AF37; border-bottom: 2px solid #D4AF37;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ban in page_obj %}
                    <tr style="border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                        <td style="padding: 12px;">
                            <strong style="color: #e8e8e8; display: block;">{{ ban.user.username }}</strong>
                            <small style="color: #95a5a6;">{{ ban.user.email }}</small>
                        </td>
                        <td style="padding: 12px; color: #e74c3c;">
                            {{ ban.reason }}
                        </td>
                        <td style="padding: 12px;">
                            <span style="color: #3498db;">{{ ban.banned_by.username }}</span>
                        </td>
                        <td style="padding: 12px; color: #95a5a6;">
                            {{ ban.ban.created_at|date:"d.m.Y H:i" }}
                        </td>
                        <td style="padding: 12px; color: #95a5a6;">
                            {{ ban.ban.expires_at|date:"d.m.Y H:i" }}
                        </td>
                        <td style="padding: 12px;">
                            {% if ban.time_remaining.days > 0 %}
                                <span style="color: #e67e22; font-weight: bold;">
                                    {{ ban.time_remaining.days }} –¥–Ω.
                                </span>
                            {% else %}
                                <span style="color: #e74c3c; font-weight: bold;">
                                    {{ ban.time_remaining.hours }} —á.
                                </span>
                            {% endif %}
                        </td>
                        <td style="padding: 12px;">
                            <button onclick="confirmUnban('{{ ban.user.id }}', '{{ ban.user.username|escapejs }}')"
                                    style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                                –†–∞–∑–±–∞–Ω–∏—Ç—å
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if page_obj.has_other_pages %}
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(212, 175, 55, 0.3);">
            <div style="display: flex; justify-content: center; gap: 10px;">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}"
                       style="background: #D4AF37; color: #1a1a1a; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-weight: bold;">
                        ‚Üê –ù–∞–∑–∞–¥
                    </a>
                {% endif %}

                <div style="display: flex; gap: 5px;">
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span style="background: #e74c3c; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                {{ num }}
                            </span>
                        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
                            <a href="?page={{ num }}"
                               style="background: #2d2d2d; color: #D4AF37; padding: 8px 15px; border-radius: 5px; text-decoration: none; border: 1px solid #D4AF37;">
                                {{ num }}
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}"
                       style="background: #D4AF37; color: #1a1a1a; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-weight: bold;">
                        –í–ø–µ—Ä–µ–¥ ‚Üí
                    </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 4em; color: #28a745; margin-bottom: 20px;">‚úÖ</div>
            <h3 style="color: #e8e8e8; margin-bottom: 10px;">–ù–µ—Ç –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <p style="color: #95a5a6;">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã –∏ –º–æ–≥—É—Ç —Å–≤–æ–±–æ–¥–Ω–æ –æ–±—â–∞—Ç—å—Å—è.</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
function confirmUnban(userId, username) {
    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) {
        const form = document.createElement('form');
        form.method = 'post';
        form.action = `{% url 'wiki:unban_user' 0 %}`.replace('0', userId);

        const csrf = document.createElement('input');
        csrf.type = 'hidden';
        csrf.name = 'csrfmiddlewaretoken';
        csrf.value = '{{ csrf_token }}';

        const reason = document.createElement('input');
        reason.type = 'hidden';
        reason.name = 'reason';
        reason.value = '–î–æ—Å—Ä–æ—á–Ω–æ–µ —Å–Ω—è—Ç–∏–µ –±–∞–Ω–∞';

        form.appendChild(csrf);
        form.appendChild(reason);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
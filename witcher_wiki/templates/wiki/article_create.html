{% extends 'base.html' %}

{% block title %}–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é | –§–æ—Ä—É–º –ø–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞{% endblock %}

{% block content %}
<style>
    .article-create {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    .section-title {
        color: #D4AF37;
        font-family: 'Cinzel', serif;
        font-size: 2.2em;
        margin-bottom: 30px;
        text-align: center;
        border-bottom: 2px solid #D4AF37;
        padding-bottom: 15px;
    }

    .form-container {
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid #D4AF37;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        color: #D4AF37;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 1.1em;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        background: #1a1a1a;
        border: 1px solid #D4AF37;
        border-radius: 8px;
        color: #e8e8e8;
        font-size: 1em;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #FFD700;
        box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
    }

    .form-select {
        width: 100%;
        padding: 12px 15px;
        background: #1a1a1a;
        border: 1px solid #D4AF37;
        border-radius: 8px;
        color: #e8e8e8;
        font-size: 1em;
    }

    textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    .form-checkbox {
        width: 18px;
        height: 18px;
        accent-color: #D4AF37;
    }

    .media-section {
        margin-top: 30px;
        padding-top: 25px;
        border-top: 1px solid rgba(212, 175, 55, 0.3);
    }

    .media-upload {
        background: rgba(212, 175, 55, 0.05);
        border: 2px dashed #D4AF37;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }

    .media-upload:hover {
        background: rgba(212, 175, 55, 0.1);
        border-color: #FFD700;
    }

    .media-upload-icon {
        font-size: 3em;
        margin-bottom: 15px;
        display: block;
    }

    .file-input {
        display: none;
    }

    .file-input-label {
        display: inline-block;
        background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);
        color: #1a1a1a;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        margin-bottom: 10px;
    }

    .file-input-label:hover {
        background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%);
        transform: translateY(-2px);
    }

    .file-info {
        color: #888;
        font-size: 0.9em;
        margin-top: 10px;
    }

    .media-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .media-item {
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid #D4AF37;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        position: relative;
    }

    .media-item img {
        max-width: 100%;
        max-height: 100px;
        border-radius: 5px;
    }

    .media-item video {
        max-width: 100%;
        max-height: 100px;
        border-radius: 5px;
    }

    .media-name {
        color: #D4AF37;
        font-size: 0.9em;
        margin-top: 8px;
        word-break: break-word;
    }

    .remove-media {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(239, 68, 68, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 0.8em;
    }

    .btn-primary {
        background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);
        color: #1a1a1a;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.1em;
        font-family: 'Cinzel', serif;
        width: 100%;
        margin-top: 20px;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid;
    }

    .alert-success {
        background: rgba(34, 197, 94, 0.1);
        border-color: #22c55e;
        color: #22c55e;
    }

    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        border-color: #ef4444;
        color: #ef4444;
    }

    .moderation-notice {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid #f59e0b;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        text-align: center;
    }

    .moderation-icon {
        font-size: 2em;
        margin-bottom: 10px;
        display: block;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ —Ö–µ—à—Ç–µ–≥–æ–≤ */
    .hashtag-suggestions {
        background: rgba(212, 175, 55, 0.1);
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border: 1px solid rgba(212, 175, 55, 0.3);
    }

    .hashtag-suggestions h4 {
        color: #D4AF37;
        margin-bottom: 10px;
        font-size: 1em;
    }

    .suggested-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .suggested-tag {
        background: rgba(23, 162, 184, 0.2);
        color: #17a2b8;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.85em;
        cursor: pointer;
        transition: all 0.3s;
        border: 1px solid rgba(23, 162, 184, 0.3);
    }

    .suggested-tag:hover {
        background: #17a2b8;
        color: white;
        transform: translateY(-2px);
    }

    @media (max-width: 768px) {
        .article-create {
            padding: 15px;
        }

        .form-container {
            padding: 20px;
        }

        .section-title {
            font-size: 1.8em;
        }

        .media-preview {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .suggested-tags {
            justify-content: center;
        }
    }
</style>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ -->
<div id="rulesModal" class="rules-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìù –ü—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç–µ–π</h2>
            <button class="close-btn" onclick="closeRulesModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="rules-section">
                <h3>‚öñÔ∏è –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:</h3>
                <ul>
                    <li>‚úÖ –°—Ç–∞—Ç—å–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–º–∞—Ç–∏–∫–µ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞</li>
                    <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∫–Ω–∏–≥, –∏–≥—Ä –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</li>
                    <li>‚úÖ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                    <li>‚úÖ –°–æ–±–ª—é–¥–∞–π—Ç–µ –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞</li>
                </ul>
            </div>

            <div class="rules-section">
                <h3>üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–æ:</h3>
                <ul>
                    <li>‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏ –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π</li>
                    <li>‚ùå –†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –º–µ–∂–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ä–æ–∑–Ω–∏</li>
                    <li>‚ùå –ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –Ω–∞—Å–∏–ª–∏—è –∏ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</li>
                    <li>‚ùå –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                    <li>‚ùå –°–ø–∞–º –∏ —Ä–µ–∫–ª–∞–º–∞</li>
                    <li>‚ùå –ü–ª–∞–≥–∏–∞—Ç –∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤</li>
                </ul>
            </div>

            <div class="rules-section">
                <h3>üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É:</h3>
                <ul>
                    <li>‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</li>
                    <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏)</li>
                    <li>‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—é –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é</li>
                    <li>‚úÖ –î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Ö–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</li>
                    <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏</li>
                </ul>
            </div>

            <div class="rules-section">
                <h3>‚è≥ –ú–æ–¥–µ—Ä–∞—Ü–∏—è:</h3>
                <ul>
                    <li>üìå –í—Å–µ —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</li>
                    <li>üìå –í—Ä–µ–º—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏: –æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤</li>
                    <li>üìå –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—å–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º</li>
                    <li>üìå –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é –ø–æ—Å–ª–µ –∑–∞–º–µ—á–∞–Ω–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</li>
                </ul>
            </div>

            <div class="agreement-section">
                <label class="checkbox-label">
                    <input type="checkbox" id="rulesAgreement">
                    <span class="checkmark"></span>
                    –Ø –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω(–∞) —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –æ–±—è–∑—É—é—Å—å –∏—Ö —Å–æ–±–ª—é–¥–∞—Ç—å
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeRulesModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" id="acceptRulesBtn" disabled onclick="acceptRules()">
                –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>
</div>

<style>
.rules-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
}

.rules-modal .modal-content {
    background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
    margin: 2% auto;
    padding: 0;
    border: 2px solid #D4AF37;
    border-radius: 15px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
}

.modal-header {
    background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);
    color: #1a1a1a;
    padding: 20px;
    border-radius: 13px 13px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-family: 'Cinzel', serif;
}

.close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #1a1a1a;
}

.modal-body {
    padding: 25px;
}

.rules-section {
    margin-bottom: 25px;
    padding: 20px;
    background: rgba(212, 175, 55, 0.05);
    border-radius: 10px;
    border-left: 4px solid #D4AF37;
}

.rules-section h3 {
    color: #D4AF37;
    margin-bottom: 15px;
    font-family: 'Cinzel', serif;
}

.rules-section ul {
    list-style: none;
    padding: 0;
}

.rules-section li {
    padding: 8px 0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
}

.rules-section li::before {
    font-size: 1.2em;
    min-width: 25px;
}

.agreement-section {
    margin-top: 30px;
    padding: 20px;
    background: rgba(34, 197, 94, 0.1);
    border-radius: 10px;
    border: 1px solid #22c55e;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-weight: 600;
    color: #22c55e;
}

.checkbox-label input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 22px;
    height: 22px;
    border: 2px solid #22c55e;
    border-radius: 4px;
    position: relative;
    transition: all 0.3s;
}

.checkbox-label input[type="checkbox"]:checked + .checkmark {
    background: #22c55e;
}

.checkbox-label input[type="checkbox"]:checked + .checkmark::after {
    content: '‚úì';
    position: absolute;
    color: white;
    font-weight: bold;
    left: 4px;
    top: -2px;
}

.modal-footer {
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 0 0 13px 13px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
}

.btn {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-family: 'Georgia', serif;
}

.btn-primary {
    background: #D4AF37;
    color: #1a1a1a;
}

.btn-primary:hover:not(:disabled) {
    background: #FFD700;
    transform: translateY(-2px);
}

.btn-primary:disabled {
    background: #666;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: #6b7280;
    color: white;
}

.btn-secondary:hover {
    background: #4b5563;
    transform: translateY(-2px);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.rules-modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.rules-modal.show .modal-content {
    animation: modalSlideIn 0.3s ease-out;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .rules-modal .modal-content {
        width: 95%;
        margin: 5% auto;
    }

    .modal-body {
        padding: 15px;
    }

    .rules-section {
        padding: 15px;
    }

    .modal-footer {
        flex-direction: column;
    }

    .btn {
        width: 100%;
    }
}
/* –§–ò–ö–° –î–õ–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –í–´–•–û–î–ê - –°–ê–ú–´–ô –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ */
#confirmationModal {
    all: unset !important;
    display: none !important;
    position: fixed !important;
    z-index: 99999 !important; /* –°–ê–ú–´–ô –í–´–°–û–ö–ò–ô */
    left: 0 !important;
    top: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background-color: rgba(0, 0, 0, 0.7) !important;
}

#confirmationModal .modal-content {
    all: unset !important;
    background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%) !important;
    margin: 15% auto !important;
    padding: 30px !important;
    border: 2px solid #D4AF37 !important;
    border-radius: 15px !important;
    width: 90% !important;
    max-width: 500px !important;
    text-align: center !important;
    position: relative !important;
    display: block !important;
}

#confirmationModal .modal-icon {
    font-size: 3em !important;
    margin-bottom: 15px !important;
    color: #D4AF37 !important;
}

#confirmationModal .modal-title {
    color: #D4AF37 !important;
    font-family: 'Cinzel', serif !important;
    font-size: 1.5em !important;
    margin-bottom: 10px !important;
}

#confirmationModal .modal-message {
    color: #e8e8e8 !important;
    margin-bottom: 25px !important;
    line-height: 1.5 !important;
}

#confirmationModal .modal-actions {
    display: flex !important;
    gap: 15px !important;
    justify-content: center !important;
}

#confirmationModal .modal-btn {
    padding: 12px 25px !important;
    border: none !important;
    border-radius: 8px !important;
    font-weight: bold !important;
    cursor: pointer !important;
    transition: all 0.3s !important;
    font-family: 'Georgia', serif !important;
}

#confirmationModal .modal-btn-confirm {
    background: #dc3545 !important;
    color: white !important;
}

#confirmationModal .modal-btn-cancel {
    background: #6c757d !important;
    color: white !important;
}
</style>

<div class="article-create">
    <h1 class="section-title">‚úçÔ∏è –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</h1>

    {% if success_message %}
    <div class="alert alert-success">
        ‚úÖ {{ success_message }}
    </div>
    {% endif %}

    {% if error_message %}
    <div class="alert alert-error">
        ‚ùå {{ error_message }}
    </div>
    {% endif %}

    {% if not user.is_staff %}
    <div class="moderation-notice">
        <span class="moderation-icon">‚è≥</span>
        <h3 style="color: #f59e0b; margin-bottom: 10px;">–°—Ç–∞—Ç—å—è –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</h3>
        <p style="color: #ccc; margin: 0;">
            –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å—è –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.
            –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.
        </p>
    </div>
    {% endif %}

    <div class="form-container">
        <form method="post" enctype="multipart/form-data" id="articleForm">
            {% csrf_token %}

            <div class="form-group">
                <label class="form-label" for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏ *</label>
                <input type="text" class="form-control" id="title" name="title"
                       value="{{ request.POST.title }}" required
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏...">
            </div>

            <div class="form-group">
                <label class="form-label" for="excerpt">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="form-control" id="excerpt" name="excerpt"
                          placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ preview)...">{{ request.POST.excerpt }}</textarea>
                <div style="color: #888; font-size: 0.9em; margin-top: 5px;">
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 150-300 —Å–∏–º–≤–æ–ª–æ–≤
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ *</label>
                <textarea class="form-control" id="content" name="content"
                          required rows="15"
                          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏...">{{ request.POST.content }}</textarea>
            </div>

            <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö –ö–ê–¢–ï–ì–û–†–ò–ô -->
            <div class="form-group">
                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;"
                     id="categories-container">
                    {% for category in categories %}
                    <div class="checkbox-group">
                        <input type="checkbox" class="form-checkbox category-checkbox" id="category-{{ category.id }}"
                               name="categories" value="{{ category.id }}">
                        <label for="category-{{ category.id }}" style="color: #ccc; margin: 0; cursor: pointer;">
                            {% if category.icon %}{{ category.icon }} {% endif %}{{ category.name }}
                        </label>
                    </div>
                    {% empty %}
                    <div style="color: #888; padding: 10px;">
                        –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
                    </div>
                    {% endfor %}
                </div>
                <small style="color: #888; display: block; margin-top: 8px;">
                    –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                </small>
                <div id="category-error" style="color: #ef4444; font-size: 0.9em; margin-top: 5px; display: none;">
                    ‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </div>
            </div>
            <!-- –ë–õ–û–ö –•–ï–®–¢–ï–ì–û–í –° –ü–û–î–°–ö–ê–ó–ö–ê–ú–ò -->
            <div class="form-group">
                <label class="form-label" for="tags">–•–µ—à—Ç–µ–≥–∏</label>
                <input type="text" class="form-control" id="tags" name="tags"
                       value="{{ request.POST.tags }}"
                       placeholder="–≤–µ–¥—å–º–∞–∫, –º–æ–Ω—Å—Ç—Ä—ã, –º–∞–≥–∏—è...">
                <small style="color: #888;">–í–≤–µ–¥–∏—Ç–µ —Ö–µ—à—Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</small>
            </div>

            <!-- –ü–û–î–°–ö–ê–ó–ö–ò –•–ï–®–¢–ï–ì–û–í -->
            <div class="hashtag-suggestions">
                <h4>üí° –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ö–µ—à—Ç–µ–≥–∏:</h4>
                <div class="suggested-tags">
                    <span class="suggested-tag" onclick="addHashtag('–≤–µ–¥—å–º–∞–∫')">#–≤–µ–¥—å–º–∞–∫</span>
                    <span class="suggested-tag" onclick="addHashtag('–≥–µ—Ä–∞–ª—å—Ç')">#–≥–µ—Ä–∞–ª—å—Ç</span>
                    <span class="suggested-tag" onclick="addHashtag('—Ü–∏—Ä–∏')">#—Ü–∏—Ä–∏</span>
                    <span class="suggested-tag" onclick="addHashtag('–π–µ–Ω–Ω–∏—Ñ–µ—Ä')">#–π–µ–Ω–Ω–∏—Ñ–µ—Ä</span>
                    <span class="suggested-tag" onclick="addHashtag('–º–æ–Ω—Å—Ç—Ä—ã')">#–º–æ–Ω—Å—Ç—Ä—ã</span>
                    <span class="suggested-tag" onclick="addHashtag('–º–∞–≥–∏—è')">#–º–∞–≥–∏—è</span>
                    <span class="suggested-tag" onclick="addHashtag('–∞–ª—Ö–∏–º–∏—è')">#–∞–ª—Ö–∏–º–∏—è</span>
                    <span class="suggested-tag" onclick="addHashtag('–∫—Ä–æ–≤—å')">#–∫—Ä–æ–≤—å</span>
                    <span class="suggested-tag" onclick="addHashtag('–≤–µ–¥—å–º–∞')">#–≤–µ–¥—å–º–∞</span>
                    <span class="suggested-tag" onclick="addHashtag('—á—É–¥–æ–≤–∏—â–∞')">#—á—É–¥–æ–≤–∏—â–∞</span>
                </div>
            </div>

            <div class="media-section">
                <h3 style="color: #D4AF37; margin-bottom: 20px; font-family: 'Cinzel', serif;">
                    üìÅ –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã
                </h3>

                <div class="media-upload">
                    <span class="media-upload-icon">üìé</span>
                    <input type="file" class="file-input" id="mediaFiles" name="media_files"
                           multiple accept="image/*,video/*,audio/*,.pdf,.doc,.docx">
                    <label for="mediaFiles" class="file-input-label">
                        üìé –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                    </label>
                    <div class="file-info">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG, GIF), –≤–∏–¥–µ–æ (MP4, AVI), –∞—É–¥–∏–æ (MP3, WAV), –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOC)
                    </div>
                </div>

                <div class="media-preview" id="mediaPreview">
                    <!-- –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
                </div>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">
                {% if user.is_staff %}
                üìù –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é
                {% else %}
                ‚è≥ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
                {% endif %}
            </button>
        </form>
    </div>
</div>

<script>
let rulesAccepted = false;

function showRulesModal() {
    const modal = document.getElementById('rulesModal');
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    document.getElementById('rulesAgreement').checked = false;
    document.getElementById('acceptRulesBtn').disabled = true;
    rulesAccepted = false;
}

function closeRulesModal() {
    const modal = document.getElementById('rulesModal');
    modal.classList.remove('show');
    document.body.style.overflow = 'auto';

    if (!rulesAccepted) {
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é, –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ –ø—Ä–∏–Ω—è—Ç—ã
        window.location.href = "{% url 'wiki:home' %}";
    }
}

function acceptRules() {
    rulesAccepted = true;
    closeRulesModal();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ–æ—Ä–º—É
    document.querySelector('.form-container').style.display = 'block';

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –ø—Ä–∞–≤–∏–ª–∞
    localStorage.setItem('article_rules_accepted', 'true');
    sessionStorage.setItem('article_rules_accepted', 'true');
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
document.getElementById('rulesAgreement').addEventListener('change', function() {
    document.getElementById('acceptRulesBtn').disabled = !this.checked;
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.getElementById('rulesModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRulesModal();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeRulesModal();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–µ—à—Ç–µ–≥–∞
function addHashtag(tagName) {
    const tagsInput = document.getElementById('tags');
    const currentValue = tagsInput.value.trim();
    const newTag = tagName.toLowerCase();

    if (currentValue === '') {
        tagsInput.value = newTag;
    } else {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —Ç–µ–≥–∞
        const tags = currentValue.split(',').map(tag => tag.trim());
        if (!tags.includes(newTag)) {
            tagsInput.value = currentValue + ', ' + newTag;
        }
    }

    tagsInput.focus();
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –ø—Ä–∏–Ω–∏–º–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–Ω–µ–µ
document.addEventListener('DOMContentLoaded', function() {
    const hasAcceptedRules = localStorage.getItem('article_rules_accepted') ||
                            sessionStorage.getItem('article_rules_accepted');

    if (!hasAcceptedRules) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
        showRulesModal();
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ–æ—Ä–º—É –¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è –ø—Ä–∞–≤–∏–ª
        document.querySelector('.form-container').style.display = 'none';
    } else {
        rulesAccepted = true;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
    const submitBtn = document.getElementById('submitBtn');
    const categoryError = document.getElementById('category-error');

    function validateCategories() {
        const checkedCategories = Array.from(categoryCheckboxes).filter(cb => cb.checked);
        const isValid = checkedCategories.length > 0;

        if (!isValid) {
            categoryError.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.title = '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
        } else {
            categoryError.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.title = '';
        }

        return isValid;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    categoryCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            validateCategories();
        });
    });

    // –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    validateCategories();
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã, –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ –ø—Ä–∏–Ω—è—Ç—ã
document.getElementById('articleForm').addEventListener('submit', function(e) {
    if (!rulesAccepted && !localStorage.getItem('article_rules_accepted') && !sessionStorage.getItem('article_rules_accepted')) {
        e.preventDefault();
        showRulesModal();
        return false;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    const title = document.getElementById('title').value.trim();
    const content = document.getElementById('content').value.trim();
    const categoriesValid = validateCategories();

    if (!title) {
        e.preventDefault();
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏');
        document.getElementById('title').focus();
        return;
    }

    if (!content) {
        e.preventDefault();
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏');
        document.getElementById('content').focus();
        return;
    }

    if (!categoriesValid) {
        e.preventDefault();
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
        return;
    }

    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
    submitBtn.disabled = true;
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
document.getElementById('mediaFiles').addEventListener('change', function(e) {
    const preview = document.getElementById('mediaPreview');
    preview.innerHTML = '';

    const files = e.target.files;
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();

        reader.onload = function(e) {
            const mediaItem = document.createElement('div');
            mediaItem.className = 'media-item';

            if (file.type.startsWith('image/')) {
                mediaItem.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <div class="media-name">${file.name}</div>
                    <button type="button" class="remove-media" onclick="removeMediaFile(${i})">√ó</button>
                `;
            } else if (file.type.startsWith('video/')) {
                mediaItem.innerHTML = `
                    <video controls>
                        <source src="${e.target.result}" type="${file.type}">
                    </video>
                    <div class="media-name">${file.name}</div>
                    <button type="button" class="remove-media" onclick="removeMediaFile(${i})">√ó</button>
                `;
            } else {
                mediaItem.innerHTML = `
                    <div style="font-size: 3em; margin-bottom: 10px;">üìÑ</div>
                    <div class="media-name">${file.name}</div>
                    <button type="button" class="remove-media" onclick="removeMediaFile(${i})">√ó</button>
                `;
            }

            preview.appendChild(mediaItem);
        };

        reader.readAsDataURL(file);
    }
});

function removeMediaFile(index) {
    const input = document.getElementById('mediaFiles');
    const files = Array.from(input.files);
    files.splice(index, 1);

    const dt = new DataTransfer();
    files.forEach(file => dt.items.add(file));
    input.files = dt.files;

    input.dispatchEvent(new Event('change'));
}
</script>
{% endblock %}
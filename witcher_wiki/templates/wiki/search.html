{% extends 'base.html' %}

{% block title %}–ü–æ–∏—Å–∫ | –§–æ—Ä—É–º –ø–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞{% endblock %}

{% block content %}
<style>
    .search-page-title {
        text-align: center;
        color: #D4AF37;
        font-family: 'Cinzel', serif;
        margin-bottom: 30px;
        font-size: 2.5em;
    }

    .search-form {
        margin-bottom: 30px;
        text-align: center;
    }
    .search-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }
    .search-form input[type="text"] {
        padding: 12px;
        width: 300px;
        max-width: 100%;
        border: 2px solid #D4AF37;
        border-radius: 5px;
        background: #1a1a1a;
        color: #e8e8e8;
        font-size: 16px;
    }
    .search-form select {
        padding: 12px;
        border: 2px solid #D4AF37;
        border-radius: 5px;
        background: #1a1a1a;
        color: #e8e8e8;
        font-size: 16px;
    }
    .search-form button {
        padding: 12px 20px;
        background: #D4AF37;
        color: #1a1a1a;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    .search-results {
        margin-bottom: 30px;
    }
    .search-result {
        background: rgba(212, 175, 55, 0.1);
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #D4AF37;
        margin-bottom: 15px;
    }
    .search-result h3 {
        margin: 0 0 10px 0;
        color: #D4AF37;
    }
    .search-result h3 a {
        color: #D4AF37;
        text-decoration: none;
    }
    .excerpt {
        color: #ccc;
        margin-bottom: 10px;
        line-height: 1.5;
    }
    .meta {
        display: flex;
        gap: 15px;
        font-size: 0.9em;
        color: #888;
        flex-wrap: wrap;
    }
    .no-results, .search-help {
        text-align: center;
        color: #ccc;
        padding: 40px 20px;
    }
    .popular-searches {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 15px;
    }
    .search-tag {
        background: rgba(212, 175, 55, 0.2);
        color: #D4AF37;
        padding: 5px 10px;
        border-radius: 15px;
        text-decoration: none;
        font-size: 0.9em;
    }
    .search-tag:hover {
        background: #D4AF37;
        color: #1a1a1a;
    }
    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 30px;
        flex-wrap: wrap;
    }
    .results-count {
        text-align: center;
        color: #888;
        margin-bottom: 20px;
        font-style: italic;
    }
</style>

<!-- –ó–ê–ì–û–õ–û–í–û–ö –ü–û–ò–°–ö–ê –¢–ï–ü–ï–†–¨ –¶–ï–ù–¢–†–ò–†–û–í–ê–ù -->
<h1 class="search-page-title">üîç –ü–æ–∏—Å–∫ –ø–æ –§–æ—Ä—É–º—É –ø–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞</h1>

<form class="search-form" method="get" action="{% url 'wiki:search' %}">
    <div class="search-controls">
        <input type="text" name="q" value="{{ query }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é, —Ç–µ–≥–∞–º...">
        <select name="category">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for cat in categories %}
            <option value="{{ cat.slug }}" {% if category_filter == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">üîç –ò—Å–∫–∞—Ç—å</button>
    </div>
</form>

<!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
{% if query %}
<div class="results-count">–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {{ total_count }}</div>
{% endif %}

<div class="search-results">
    {% if results %}
        {% for article in results %}
        <div class="search-result">
            <h3><a href="{% url 'wiki:article_detail' article.slug %}">üìñ {{ article.title }}</a></h3>
            <p class="excerpt">{{ article.excerpt|truncatechars:200|default:"–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç" }}...</p>
            <div class="meta">
                <span>üë§
                    <a href="{% url 'wiki:user_public_profile' article.author.username %}"
                       style="color: #D4AF37; text-decoration: none;">
                        {{ article.author.username }}
                    </a>
                </span>
                <span>üìÖ {{ article.created_at|date:"d.m.Y" }}</span>
                <span>üìÇ {% for cat in article.categories.all %}{{ cat.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</span>
            </div>
        </div>
        {% endfor %}
    {% elif query %}
        <div class="no-results">
            <h3>‚ùå –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
            <ul>
                <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è</li>
                <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã</li>
                <li>–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–∏–Ω–æ–Ω–∏–º—ã</li>
                <li>–£–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
            </ul>
        </div>
    {% else %}
        <div class="search-help">
            <h3>üîç –ö–∞–∫ –∏—Å–∫–∞—Ç—å –≤ –§–æ—Ä—É–º–µ –ø–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –í–µ–¥—å–º–∞–∫–∞?</h3>
            <div class="help-content">
                <p><strong>–í–Ω–µ—à–Ω–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –º–µ—Å—Ç–∞ –∏–ª–∏ —Å–æ–±—ã—Ç–∏—è</strong><br>
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—É—é –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.</p>

                <p><strong>–ü–æ–∏—Å–∫ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</strong><br>
                –ü–æ–∏—Å–∫ –≤–µ–¥–µ—Ç—Å—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –∏ —Ç–µ–≥–∞–º.</p>
            </div>
            <h4>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:</h4>
            <div class="popular-searches">
                <a href="{% url 'wiki:search' %}?q=–ì–µ—Ä–∞–ª—å—Ç" class="search-tag">–ì–µ—Ä–∞–ª—å—Ç</a>
                <a href="{% url 'wiki:search' %}?q=–¶–∏—Ä–∏" class="search-tag">–¶–∏—Ä–∏</a>
                <a href="{% url 'wiki:search' %}?q=–ô–µ–Ω–Ω–∏—Ñ—ç—Ä" class="search-tag">–ô–µ–Ω–Ω–∏—Ñ—ç—Ä</a>
                <a href="{% url 'wiki:search' %}?q=–¢—Ä–∏—Å—Å" class="search-tag">–¢—Ä–∏—Å—Å</a>
                <a href="{% url 'wiki:search' %}?q=–í–µ–ª–∞–Ω–¥" class="search-tag">–í–µ–ª–∞–Ω–¥</a>
                <a href="{% url 'wiki:search' %}?q=–ö–∞—ç—Ä –ú–æ—Ä—Ö–µ–Ω" class="search-tag">–ö–∞—ç—Ä –ú–æ—Ä—Ö–µ–Ω</a>
                <a href="{% url 'wiki:search' %}?q=–ù–æ–≤–∏–≥—Ä–∞–¥" class="search-tag">–ù–æ–≤–∏–≥—Ä–∞–¥</a>
                <a href="{% url 'wiki:search' %}?q=–í–µ–¥—å–º–∞–∫" class="search-tag">–í–µ–¥—å–º–∞–∫</a>
                <a href="{% url 'wiki:search' %}?q=–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ" class="search-tag">–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ</a>
                <a href="{% url 'wiki:search' %}?q=–ì–≤–∏–Ω—Ç" class="search-tag">–ì–≤–∏–Ω—Ç</a>
            </div>
        </div>
    {% endif %}
</div>

{% if results.has_other_pages %}
<div class="pagination">
    {% if results.has_previous %}
        <a href="?q={{ query }}&category={{ category_filter }}&page={{ results.previous_page_number }}" class="page-btn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    {% endif %}

    {% for num in results.paginator.page_range %}
        {% if num == results.number %}
            <span class="page-current">{{ num }}</span>
        {% else %}
            <a href="?q={{ query }}&category={{ category_filter }}&page={{ num }}" class="page-btn">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if results.has_next %}
        <a href="?q={{ query }}&category={{ category_filter }}&page={{ results.next_page_number }}" class="page-btn">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
    {% endif %}
</div>
{% endif %}

<div style="text-align: center; margin-top: 30px;">
    <a href="{% url 'wiki:home' %}" class="btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>
{% endblock %}